build:
  docker:
    repository: forhot2000/node-hello

deploy:
  ecs:
    tasks:
      - family: "sw-stg-test-node-hello-task"
        containerDefinitions: 
          - image: 
              fromBuild: true
            name: node_hello_web
            volumesFrom: []
            portMappings:
              - "1338:8080"
            command: []
            environment: []
            essential: true
            entryPoint: []
            links: []
            mountPoints: 
              - containerPath: "/work/logs"
                sourceVolume: logs
                readOnly: false
            memory: 200
            cpu: 100

          - image: 
              name: redis
            name: node_hello_redis
            volumesFrom: []
            portMappings: []
            command: []
            environment: []
            essential: false
            entryPoint: []
            links: []
            mountPoints: []
            memory: 200
            cpu: 100

        volumes: 
          - name: logs
            host: 
              sourcePath: "/var/log/forhot2000/node_hello"

    services:
      - cluster: sw_cloud
        serviceName: "sw-stg-test-node-hello-svc"
        taskDefinition: "sw-stg-test-node-hello-task"
        loadBalancers: 
          - loadBalancerName: "sw-stg-test-node-hello-elb"
            containerName: node_hello_web
            containerPort: 1338
        desiredCount: 2
        role: ecsServiceRole

test:
  integreation:
    - checkurl:
        container: node_hello_web
        port: 1338
    # - shell: "integration_test.sh"

# branches:
#   only:
#     - master
#     - develop
